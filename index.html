<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Allen Spelling Bee â€” Nebula Edition</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- é–‹å ´å‹•ç•« -->
  <div id="intro-screen">
    <canvas id="intro-nebula"></canvas>
    <div id="intro-text">Welcome, Allen! â€” Nebula Edition</div>
  </div>

  <!-- æ˜Ÿé›²èƒŒæ™¯ -->
  <canvas id="nebula-bg"></canvas>

  <!-- ä¸»é å…§å®¹ -->
  <div id="app" style="display:none">
    <h1 class="big">ğŸŒ€ Allen Spelling Bee</h1>

    <div class="card">
      <h2>ğŸ“š åˆ†é€±ç·´ç¿’</h2>
      <div id="weekButtons"></div>
    </div>

    <div class="card">
      <h2>ğŸ”¥ æ¯æ—¥æŒ‘æˆ°</h2>
      <button class="btn" onclick="startDaily()">é–‹å§‹æŒ‘æˆ°ï¼ˆ20 é¡Œï¼‰</button>
    </div>

    <div class="card">
      <h2>ğŸ… æˆ‘çš„çµ±è¨ˆ</h2>
      <div id="statsArea"></div>
    </div>

    <div class="card">
      <h2>ğŸ å°å•†åº—</h2>
      <button class="btn" onclick="openStore()">é€²å…¥å°å•†åº—</button>
    </div>
  </div>

  <!-- Script -->
  <script>
  const $ = s => document.querySelector(s);
  const app = $("#app");
  let STATE = { mode:"menu", week:null, list:[], index:0, correct:0, total:0 };

  window.addEventListener("DOMContentLoaded", ()=>{
    setTimeout(()=>{
      $("#intro-screen").style.display="none";
      $("#app").style.display="block";
      initApp();
    },3500);
  });

  function initApp(){
    app.innerHTML = `
      <h1 class="big">ğŸŒ€ Allen Spelling Bee</h1>
      <div class="card">
        <h2>ğŸ“š åˆ†é€±ç·´ç¿’</h2>
        <div id="weekButtons"></div>
      </div>
      <div class="card">
        <h2>ğŸ”¥ æ¯æ—¥æŒ‘æˆ°</h2>
        <button class="btn" onclick="startDaily()">é–‹å§‹æŒ‘æˆ°ï¼ˆ20 é¡Œï¼‰</button>
      </div>
      <div class="card">
        <h2>ğŸ… æˆ‘çš„çµ±è¨ˆ</h2>
        <div id="statsArea"></div>
      </div>
      <div class="card">
        <h2>ğŸ å°å•†åº—</h2>
        <button class="btn" onclick="openStore()">é€²å…¥å°å•†åº—</button>
      </div>`;
    renderWeekButtons(); renderStats();
  }

  function renderWeekButtons(){
    const container=$("#weekButtons");
    container.innerHTML=Object.keys(BANKS)
      .map(wk=>`<button class="btn" onclick="startWeek('${wk}')">Week ${wk}</button>`)
      .join(" ");
  }

  function startWeek(week){
    STATE={mode:"week",week, list:shuffle([...BANKS[week]]),index:0,correct:0,total:0};
    showQuestion();
  }

  function startDaily(){
    STATE={mode:"daily",week:null,list:shuffle(loadAllWords()).slice(0,20),index:0,correct:0,total:0};
    showQuestion();
  }

  function showQuestion(){
    if(STATE.index>=STATE.list.length)return showResult();
    const w=STATE.list[STATE.index];
    const header = STATE.mode==="daily" ? "ğŸ”¥ æ¯æ—¥æŒ‘æˆ°" : `Week ${STATE.week}`;
    app.innerHTML=`
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h2>${header}</h2>
          <button class="btn small" onclick="confirmBack()">è¿”å›</button>
        </div>
        <p>ç¬¬ ${STATE.index+1} / ${STATE.list.length} é¡Œ</p>
        <input id="ans" class="input" placeholder="è¼¸å…¥è‹±æ–‡å–®å­—" autocomplete="off"
          onkeydown="if(event.key==='Enter'){checkAns();}">
        <div style="margin-top:10px;">
          <button class="btn" onclick="speak('${w.word}')">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
          <button class="btn" onclick="checkAns()">ç¢ºèª</button>
        </div>
        <div id="feedback" class="small" style="margin-top:12px;min-height:50px;"></div>
      </div>`;
    speak(w.word); $("#ans").focus();
  }

  function checkAns(){
    const input=$("#ans").value.trim().toLowerCase();
    if(!input)return;
    const w=STATE.list[STATE.index];
    const ok=input===w.word.toLowerCase();
    STATE.total++;
    let fb="";
    if(ok){STATE.correct++;fb=`<span style="color:#5bd68a">âœ” æ­£ç¢ºï¼</span> ${w.meaning}`;}
    else{fb=`<span style="color:#ff6b6b">âœ˜ éŒ¯èª¤</span> æ­£ç¢ºç­”æ¡ˆï¼š${w.word} (${w.meaning})`;}
    $("#feedback").innerHTML=`
      ${fb}
      <br><br>
      <button class="btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ âœ</button>`;
  }

  function nextQuestion(){STATE.index++;showQuestion();}

  function confirmBack(){
    if(confirm("ç¢ºå®šè¦è¿”å›ä¸»é å—ï¼Ÿ\nç›®å‰é€²åº¦å°‡ä¸æœƒä¿å­˜ã€‚")) initApp();
  }

  function showResult(){
    const rate=Math.round((STATE.correct/STATE.total)*100);
    const modeText=STATE.mode==="daily"?"æ¯æ—¥æŒ‘æˆ°":`Week ${STATE.week}`;
    app.innerHTML=`
      <div class="card">
        <h2>âœ… ${modeText} å®Œæˆ</h2>
        <p>ç­”å° ${STATE.correct}/${STATE.total} é¡Œ (${rate}%)</p>
        <button class="btn" onclick="initApp()">å›ä¸»é </button>
      </div>`;
  }

  function loadAllWords(){
    const all=[];for(const k in BANKS)(BANKS[k]||[]).forEach(it=>all.push(it));
    return all;
  }

  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

  function speak(t){const
