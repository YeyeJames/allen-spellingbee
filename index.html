<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Allen Spelling Bee â€” æ˜Ÿç©ºä¸»é¸å–®ç‰ˆ</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
  <canvas id="stars"></canvas>

  <!-- ä¸»å…§å®¹ -->
  <div id="app">
    <h1 class="big">ğŸŒ€ Allen Spelling Bee</h1>

    <div id="coinBar">ğŸ’° å–®å­—å¹£ï¼š<b>0</b></div>

    <div id="menuGrid">
      <div class="menu-item" onclick="showWeeks()">
        <div class="icon">ğŸ“š</div>
        <div class="title">åˆ†é€±ç·´ç¿’</div>
        <div class="desc">é¸æ“‡è¦ç·´ç¿’çš„é€±æ¬¡å–®å­—</div>
      </div>

      <div class="menu-item" onclick="startDaily()">
        <div class="icon">ğŸ”¥</div>
        <div class="title">æ¯æ—¥æŒ‘æˆ°</div>
        <div class="desc">é™æ™‚ 20 é¡Œæ‹¼å­—æŒ‘æˆ°</div>
      </div>

      <div class="menu-item" onclick="showMissions()">
        <div class="icon">ğŸ“‹</div>
        <div class="title">ä»Šæ—¥ä»»å‹™</div>
        <div class="desc">æŸ¥çœ‹å­¸ç¿’ä»»å‹™èˆ‡çå‹µ</div>
      </div>

      <div class="menu-item" onclick="openStore()">
        <div class="icon">ğŸ</div>
        <div class="title">å°å•†åº—</div>
        <div class="desc">ç”¨å–®å­—å¹£è³¼è²·ç‰¹æ•ˆèˆ‡é€ å‹</div>
      </div>

      <div class="menu-item" onclick="showStats()">
        <div class="icon">ğŸ…</div>
        <div class="title">æˆ‘çš„çµ±è¨ˆ</div>
        <div class="desc">æŸ¥çœ‹ç·´ç¿’æ¬¡æ•¸èˆ‡æ­£ç¢ºç‡</div>
      </div>
    </div>
  </div>

  <!-- === ä¸»è¦è…³æœ¬ === -->
  <script>
  const $ = s => document.querySelector(s);
  const app = $("#app");

  window.addEventListener("DOMContentLoaded", ()=>{
    updateCoins();
    dispatchEvent(new CustomEvent("allen:start"));
    startStars();
  });

  function updateCoins(){
    const coins=parseInt(localStorage.getItem("allen_coins")||0);
    $("#coinBar").innerHTML=`ğŸ’° å–®å­—å¹£ï¼š<b>${coins}</b>`;
  }

  // === é¡¯ç¤ºåˆ†é€±ç·´ç¿’ ===
  function showWeeks(){
    const weeksHTML = Object.keys(BANKS)
      .map(w=>`<button class="btn" onclick="startWeek('${w}')">Week ${w}</button>`)
      .join(" ");
    app.innerHTML = `
      <h1 class="big">ğŸ“š åˆ†é€±ç·´ç¿’</h1>
      <div class="card">
        <div style="text-align:center;margin-bottom:16px;">è«‹é¸æ“‡è¦ç·´ç¿’çš„é€±æ¬¡ï¼š</div>
        <div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;">
          ${weeksHTML}
        </div>
      </div>
      <button class="btn" style="margin-top:20px;" onclick="initApp()">è¿”å›ä¸»é¸å–®</button>
    `;
  }

  // === é–‹å§‹æŸé€±ç·´ç¿’ ===
  function startWeek(week){
    STATE={mode:"week",week,list:shuffle([...BANKS[week]]),index:0,correct:0,total:0,streak:0};
    showQuestion();
  }

  // === æ¯æ—¥æŒ‘æˆ° ===
  function startDaily(){
    STATE={mode:"daily",week:null,list:shuffle(loadAllWords()).slice(0,20),index:0,correct:0,total:0,streak:0};
    showQuestion();
  }

  // === é¡¯ç¤ºçµ±è¨ˆ ===
  function showStats(){
    const s=JSON.parse(localStorage.getItem("allen_stats")||'{"runs":0,"avg":0}');
    app.innerHTML=`
      <h1 class="big">ğŸ… æˆ‘çš„çµ±è¨ˆ</h1>
      <div class="card">
        <p>ç´¯ç©ç·´ç¿’æ¬¡æ•¸ï¼š${s.runs||0}</p>
        <p>å¹³å‡æ­£ç¢ºç‡ï¼š${s.avg?s.avg.toFixed(1):0}%</p>
        <button class="btn" onclick="clearStats()">æ¸…é™¤ç´€éŒ„</button>
      </div>
      <button class="btn" onclick="initApp()">è¿”å›ä¸»é¸å–®</button>
    `;
  }

  function clearStats(){
    localStorage.removeItem("allen_stats");
    showStats();
  }

  // === å·¥å…· ===
  function loadAllWords(){
    const all=[];for(const k in BANKS)(BANKS[k]||[]).forEach(it=>all.push(it));
    return all;
  }
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

  // === æ˜Ÿç©ºèƒŒæ™¯ ===
  function startStars(){
    const canvas=document.getElementById('stars');
    const ctx=canvas.getContext('2d');
    let w,h; const stars=[];
    function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
    window.addEventListener('resize',resize); resize();
    for(let i=0;i<60;i++){stars.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.5,s:Math.random()*0.5+0.2});}
    function draw(){
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle="#ffffff";
      stars.forEach(star=>{
        ctx.globalAlpha=Math.random()*0.5+0.3;
        ctx.beginPath();ctx.arc(star.x,star.y,star.r,0,Math.PI*2);ctx.fill();
        star.y+=star.s;if(star.y>h)star.y=0;
      });
      requestAnimationFrame(draw);
    }
    draw();
  }
  </script>

  <!-- === æ¨¡çµ„ === -->
  <script src="banks.js"></script>
  <script src="script-store.js"></script>
  <script src="meow-teacher.js"></script>
  <script src="missions.js"></script>
</body>
</html>